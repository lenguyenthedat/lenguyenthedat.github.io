---
layout: post
title: Parsing config files in Haskell with Yaml
date: '2014-01-23T08:54:00.002-08:00'
author: Dat Le
tags: 
modified_time: '2014-02-03T10:41:25.829-08:00'
comments: true
blogger_id: tag:blogger.com,1999:blog-3261104696526323937.post-7757173831553117106
blogger_orig_url: http://lenguyenthedat.blogspot.com/2014/01/parsing-config-file-in-haskell-with-yaml.html
---

Sample config files:<br /><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">app:<br />  port: 9000<br />  limit: 100<br />db:<br />  host: "my.database.com"<br />  port: 5439<br />  user: "admin"<br />  database: "mydb"<br />s3:<br />  bucket: "my-s3-bucket"<br />  access: "ABASDSAMPLEACESSKEY" <br />  secret: "312312YASDASAMPLESECRETKEY"</span></span></pre></div></li></ul><br />Import necessary modules:<br /><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">import Control.Applicative<br />import Data.Yaml -- you need to install yaml beforehand with cabal</span></span></pre></div></li></ul><br />Define your config data type:<br /><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">data MyConfig = MyConfig {<br />    app :: AppConfig,<br />    db :: DbConfig,<br />    s3 :: S3Config<br />  } deriving Show<br />data AppConfig = AppConfig {<br />    port :: Int,<br />    limit :: Int<br />  } deriving Show<br />data DbConfig = DbConfig {<br />    host :: String,<br />    port :: Int,<br />    user :: String,<br />    database :: String<br />  } deriving Show<br />data S3Config = S3Config {<br />    bucket :: String,<br />    access :: String,<br />    secret :: String<br />  } deriving Show</span></span></pre></div></li></ul><br />Define your config data types as instances of FromJSON - for parsing purpose:<br /><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">instance FromJSON MyConfig where<br />    parseJSON (Object m) = MyConfig &lt;$&gt;<br />        m .: "app" &lt;*&gt;<br />        m .: "db" &lt;*&gt;<br />        m .: "s3"<br />    parseJSON x = fail ("not an object: " ++ show x)       <br />instance FromJSON AppConfig where<br />    parseJSON (Object m) = AppConfig &lt;$&gt;<br />        m .: "port" &lt;*&gt;<br />        m .: "limit"<br />    parseJSON x = fail ("not an object: " ++ show x)<br />instance FromJSON DbConfig where<br />    parseJSON (Object m) = DbConfig &lt;$&gt;<br />        m .: "host" &lt;*&gt;<br />        m .: "port" &lt;*&gt;<br />        m .: "user" &lt;*&gt;<br />        m .: "database"<br />    parseJSON x = fail ("not an object: " ++ show x)<br />instance FromJSON S3Config where<br />    parseJSON (Object m) = S3Config &lt;$&gt;<br />        m .: "bucket" &lt;*&gt;<br />        m .: "access" &lt;*&gt;<br />        m .: "secret"<br />    parseJSON x = fail ("not an object: " ++ show x)</span></span></pre></div></li></ul><br />Finally, to read the given config file:<br /><div class="article-content entry-content" itemprop="articleBody" style="background-color: white; clear: both; margin: 10px auto 5px; orphans: auto; outline: none; padding: 0px; text-align: justify; text-indent: 0px; widows: auto;"><ul style="background-color: white; list-style: disc; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">readMyConfig :: IO MyConfig<br />readMyConfig =<br />    either (error . show) id &lt;$&gt;<br />    decodeFileEither "./Config/myconfig.cfg"</span></span><span style="color: #333333; font-family: Helvetica Neue Light, HelveticaNeue-Light, Helvetica Neue, Helvetica, Arial, sans-serif;"><span style="font-size: 14px; line-height: 1.4; white-space: normal;"><br /></span></span></pre></div></li></ul><div><div style="text-align: start;"><br /></div></div></div>