---
layout: post
title: Dumping Oracle DB's Table into CSV with sqlplus...
date: '2014-01-08T00:01:00.001-08:00'
author: Dat Le
tags: oracle, data warehouse, sqlplus, etl
modified_time: '2014-01-14T07:46:53.152-08:00'
comments: true
blogger_id: tag:blogger.com,1999:blog-3261104696526323937.post-8068724103908643930
blogger_orig_url: https://lenguyenthedat.blogspot.com/2014/01/dumping-oracle-dbs-table-into-csv-with.html
---

After a few hours without no luck trying to find the best way to dump Oracle DB's table into CSV with sqlplus, I've came up with my own solution. It might not be the best one, but at least it works for me:<br /><br />SQL file query.sql:<br /><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">SET COLSEP '|'<br />SET ECHO OFF<br />SET FEEDBACK OFF<br />SET TERMOUT OFF<br />SET PAGESIZE 32766 -- Maximum number we can set.<br />                   -- i.e there will be duplication of headers. <br />SET LINESIZE 32766 -- Maximum number we can set.</span></span><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">SET NEWPAGE NONE<br />SET VERIFY OFF<br />SET TERM OFF<br />SET TRIMS ON<br />SET TRIMSPOOL ON<br />SET UNDERLINE OFF<br /><br />SPOOL path/to/output_file.csv<br /><br />SELECT * FROM user.table;<br /><br />SPOOL OFF<br /><br />EXIT</span></span></pre></div></li></ul><br />Executing above SQL file:<br /><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">$ export NLS_LANG=.AL32UTF8 # For character encoding<br />$ export LD_LIBRARY_PATH=/usr/lib/oracle/12.1/client64/lib/ # Oracle Lib Home<br />$ sqlplus64 -s username/password@"(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=oracle.server.ip.address)(PORT=port_number))(CONNECT_DATA=(SID=connection_string)))" @query.sql</span></span></pre></div></li></ul><div style="text-align: justify;"><span style="color: #333333; font-family: monospace;"><span style="font-size: 14px; line-height: 20px; white-space: pre;"><br /></span></span></div><div style="text-align: justify;"><div style="text-align: start;">Remove trailing spaces / tabs:</div></div><div style="text-align: justify;"><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">$ cat path/to/output_file.csv | awk '$1=$1' | sed -e 's/|\s\+/|/g' | sed -e 's/\s\+|/|/g' | awk '!a[$0]++' &gt; path/to/final_output_file.csv<br /># Explain: <br /># awk '$1=$1': delete leading spaces<br /># sed -e 's/|\s\+/|/g' | sed -e 's/\s\+|/|/g': remove spaces before and after delimiter "|"<br /># awk '!a[$0]++': remove duplications</span></span></pre></div></li></ul><div><span style="color: #333333; font-family: monospace;"><span style="font-size: 14px; line-height: 20px; white-space: pre;"><br /></span></span></div><div><div style="text-align: start;">Done!</div><div style="text-align: start;"><br /></div><div style="text-align: start;">PS: As for comparison, this task would be so much easier with PostgreSQL...</div></div><div><ul style="background-color: white; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em;"><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">psql -t -A -F'|' -h $PG_ENDPOINT -U $PG_USER -d $PG_DB -p $PG_PORT -c "SELECT * FROM schema.table;"</span></span></pre></div></li></ul></div></div>