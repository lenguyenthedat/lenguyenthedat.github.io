---
layout: post
title: Managing User Privileges with Amazon Redshift / PostgreSQL.
date: '2014-07-18T07:20:00.003-07:00'
author: Dat Le
tags: 
modified_time: '2014-07-18T07:46:52.538-07:00'
thumbnail: http://2.bp.blogspot.com/-D55vGrk18C8/U8kwlHvMoII/AAAAAAAADIc/uc99yN4ldS4/s72-c/Screen+Shot+2014-07-18+at+22.35.41.png
blogger_id: tag:blogger.com,1999:blog-3261104696526323937.post-3941548674700694368
blogger_orig_url: http://lenguyenthedat.blogspot.com/2014/07/managing-user-privileges-with-amazon.html
---

<div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-D55vGrk18C8/U8kwlHvMoII/AAAAAAAADIc/uc99yN4ldS4/s1600/Screen+Shot+2014-07-18+at+22.35.41.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-D55vGrk18C8/U8kwlHvMoII/AAAAAAAADIc/uc99yN4ldS4/s1600/Screen+Shot+2014-07-18+at+22.35.41.png" height="298" width="400" /></a></div><br /><br />Managing user privileges within a system is always a hard problem in general.</div><div>In particular, it's even a harder problem for PostgreSQL Database, especially Amazon Redshift (which only supports&nbsp;<i>a subset of</i> PostgreSQL 8.0.2 features).</div><div><br /></div>Supposed you now have your <a href="http://lenguyenthedat.blogspot.sg/2014/07/building-full-data-warehouse-solution.html">Data Warehouse running on Amazon Redshift</a>.<br /><div><br /></div><div>By default, &nbsp;you will have all privileges for &nbsp;Schemas / Tables / Views that you've created or listed as an owner.</div><div><br /></div><div>Now, to give read access for a user U1 to a certain table T1 within schema S1, you will then need to execute:</div><div><ul style="background-color: white; color: #333333; font-family: 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 14px; line-height: 19.600000381469727px; list-style-image: initial; list-style-position: initial; margin: 0.5em 0px; outline: none; padding: 0px 0px 0px 2em; text-align: justify;"><li style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="line-height: 20px;">GRANT USAGE ON SCHEMA S1 TO U1;<br />GRANT SELECT ON TABLE S1.T1 TO U1;</span></pre></li></ul></div><div><br /></div><div>Of course, that's pretty simple and straightforward. However, when you have tens of schemas, thousands of tables to hundreds of users, how would you do it?</div><div>A similar problem arises when you then need to drop a user with various access types to a good number of tables in your database (hint: you will need to revoke all those privileges first), or you need to transfer ownership of user X to user Y.</div><div><br /></div><div>(Brief) Answer / Hint: you do it programmatically with:</div><div><ul><li>Query information_schema.schemata; pg_tables; pg_views: for your schemas, tables and views list.</li><li>Store the list into your program.</li><li>Use customized string manipulation functions to create a composed GRANT Query accordingly.</li></ul><div>Good luck hacking :).</div><div><br /></div><div>PS: In case you need to solve this problem ASAP, here is a little <a href="https://github.com/zalora/postgresql-user-manager">command-line interface tool</a>&nbsp;(named:&nbsp;postgresql-user-manager) that I've developed while working at Zalora :).</div></div><div><br /></div><div><br /></div>