---
layout: post
title: Create a downstream PostgreSQL Database with dblink
date: '2014-05-14T03:26:00.000-07:00'
author: Dat Le
tags: 
modified_time: '2014-07-12T23:36:28.620-07:00'
comments: true
blogger_id: tag:blogger.com,1999:blog-3261104696526323937.post-5467635293146884147
blogger_orig_url: http://lenguyenthedat.blogspot.com/2014/05/create-downstream-postgresql-database.html
---

Ran into this request just today, so for this, I will just refer to:<br /><br /><ul><li>An Amazon Redshift cluster as an Upstream Database.</li><li>An Amazon RDS instance as a Downstream Database</li></ul><br />Prerequisite: An Amazon Redshift cluster running.<br />Step-by-step instructions:<br /><br /><ul><li>Create your RDS instance (PostgreSQL) from Amazon RDS: https://aws.amazon.com/rds/</li><li>Connect to your instance (Remember to set your instance permission / firewall properly):</li><li style="margin: 0px; outline: none; padding: 0px;"><div style="margin: 0px; outline: none; padding: 0px;"><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">psql -h your.rds.address -p port -U username -d dbname</span></span></pre></div></li><li>Configuring dblink:</li><li><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">CREATE EXTENSION dblink;<br />SELECT dblink_connect('dbname=dbname user=user password=password host=your.redshift.address port=port');</span></span></pre></li><li>Copy a table from Redshift to RDS:&nbsp;</li></ul><span style="background-color: whitesmoke; font-family: 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; text-align: justify;">Note: currently - July 2014 - there is a bug that prevents the following query to finish, when you try to do it from an RDS instance type M3 or R3 - the query would run on Redshift for about 15 minutes (you can't even kill it) and ends with a blank error message.&nbsp;</span><span style="background-color: whitesmoke; font-family: 'Helvetica Neue Light', HelveticaNeue-Light, 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; text-align: justify;">Just choose RDS Instance type M1 and it would be just fine :).</span><br /><ul><li><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">SELECT mytable.*<br />INTO rds_schema_name.rds_table_name<br />FROM<br />    dblink('SELECT field_1, field_2 FROM redshift_schema.redshift_table')<br />AS<br />    mytable(field_1 text, field_2 text);</span></span></pre></li><li>Get data from the given table in RDS:</li><li><pre style="background-color: #f0f0f0; border: 1px dashed rgb(204, 204, 204); height: auto; overflow: auto; padding: 0px; width: 646.46875px;"><span style="color: #333333;"><span style="font-size: 14px; line-height: 20px;">SELECT field_1, field_2<br />FROM rds_schema_name.rds_table_name;</span></span></pre></li></ul>